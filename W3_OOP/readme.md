# Scoring API

This repository contains a script for processing POST request for online scoring or users interests.

### General principles:

you have to send a request with the following structure:

{"account": "<company name>", "login": "<user login>", "method": "<method name>", "token":
"<auth token>", "arguments": {<dict with special arguments>}}
- account ‑ sting, not required, can be empty
- login ‑ sting, required, can be empty
- method ‑ sting, required, can be empty
- token ‑ sting, required, can be empty
- arguments ‑ dict (json object), required, can be empty

Response structure can be in the following forms

- if all fields were constructed correctly

```
{"code": <three-digit code>, "response": {<method response>}}

```

- in case of errors:

```
{"code": <three-digit code>, "error": {<error message>}}
```

### Online scoring method

- **Arguments**

    - phone ‑ string or number with lengh 11, begins with 7, not required, can be empty
    - email ‑ string which contains @, not required, can be empty
    - first_name ‑ string , not required, can be empty
    - last_name ‑ string , not required, can be empty
    - birthday ‑ date with format DD.MM.YYYY, not older 70 years from today, not required, can be empty
    - gender ‑ number 0, 1 or 2, not required, can be empty

- **Validation** 
    - Every argument has to be valid 
    - Any pair from the followings have to be non empty : phone‑email, first name‑last name, gender‑birthday.

- **Context dict** 
    - code " has" , 
    - values list with non empty fields

- **Response**
    - Number generated by get_score function. 
    - If user is admin the number is 42.

```
Query: 
$ curl -X POST -H "Content-Type: application/json" -d '{"account": "horns&hoofs", "login": "h&f",
"method": "online_score", "token":
"55cc9ce545bcd144300fe9efc28e65d415b923ebb6be1e19d2750a2c03e80dd209a27954dca045e5bb12418e7d89b6d718a9e35af3
"arguments": {"phone": "79171111111", "email": "jack@daniels.ru", "first_name": "Jack",
"last_name": "Daniels", "birthday": "01.01.1980", "gender": 1}}' http://127.0.0.1:8080/method/

Response:
{"code": 200, "response": {"score": 5.0}}
```


### clients_interests.

- **Arguments**

    - client_ids ‑ list with numbers, required, can not be empty
    - date ‑ date with format DD.MM.YYYY, not required, can be empty

- **Validation** 
    - Every argument has to be valid 
    
- **Context dict** 
    - code "nclients"" , 
    - values number of ids

- **Response**
    - dict in form <client id>: interest list> . Interest list is generated by get_interests function

```
Query: 
$ curl -X POST -H "Content-Type: application/json" -d '{"account": "horns&hoofs", "login": "admin",
"method": "clients_interests", "token":
"d3573aff1555cd67dccf21b95fe8c4dc8732f33fd4e32461b7fe6a71d83c947688515e36774c00fb630b039fe2223c991f045f13f2
"arguments": {"client_ids": [1,2,3,4], "date": "20.07.2017"}}' http://127.0.0.1:8080/method/

Response:
{"code": 200, "response": {"1": ["books", "hi-tech"], "2": ["pets", "tv"], "3": ["travel", "music"],
"4": ["cinema", "geek"]}}
```

## Getting Started

### Prerequisites

1. Python version 3.6 and above
2. Pytest library for running tests

### Installing and running

1. No special installation procedure is required. You have to copy the files and folders from this repository in one folder
2. You have to run the server from the main directory. You can do it with the following command:

```
python sample/api.py

```

## Running the tests

### Brief description

1. Tests are grouped into two script and located in _tests_ directory. 
2. Below we provide the general logic of each test inside test script.
    * **test_field_types**. Actually inside of this script are unittest for every field class object     
    * **test_integration**. These tests check an interaction between the main objects of api script. Include three sets:
        * **TestResponseRequest**. It checks that the script process correctly the cases when invalid token or invalid request sent
        * **TestOnlineScoreMethod** and **TestGetInterestMethod** check different scenarios related with correct work of these methods

### Deployement testing environment
In order to run pytests you have to do the following steps:
1. Copy folder _tests_ into the same directory (hereafter main directory) where folder sample is located, 
2. Run tests. For example:

```
pytest -s -v tests

```


## License

This project is licensed under the MIT License
